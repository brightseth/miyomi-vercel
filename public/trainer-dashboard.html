<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIYOMI - Trainer Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000;
      color: #fff;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-weight: bold;
      padding: 20px;
    }

    .auth-gate {
      max-width: 400px;
      margin: 100px auto;
      padding: 40px;
      background: #111;
      border: 2px solid #ff00ff;
      border-radius: 10px;
      text-align: center;
    }

    .auth-gate h2 {
      color: #ff00ff;
      margin-bottom: 30px;
    }

    .auth-input {
      width: 100%;
      padding: 12px;
      background: #000;
      border: 1px solid #666;
      color: #fff;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .auth-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #ff00ff, #00ffff);
      color: #000;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .auth-btn:hover {
      transform: scale(1.02);
    }

    .dashboard {
      display: none;
      max-width: 1400px;
      margin: 0 auto;
    }

    .dashboard.authenticated {
      display: block;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, #ff00ff20, #00ffff20);
      border: 1px solid #ff00ff;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 24px;
      background: linear-gradient(90deg, #ff00ff, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .trainer-info {
      font-size: 12px;
      color: #00ffff;
    }

    .logout-btn {
      padding: 8px 16px;
      background: #ff0000;
      border: none;
      color: #fff;
      cursor: pointer;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 1px solid #333;
    }

    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: #888;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 2px solid transparent;
    }

    .tab.active {
      color: #ff00ff;
      border-bottom-color: #ff00ff;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .picks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .pick-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 20px;
      transition: all 0.3s;
    }

    .pick-card:hover {
      border-color: #ff00ff;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
    }

    .pick-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .pick-platform {
      font-size: 10px;
      padding: 3px 8px;
      background: #00ffff20;
      border: 1px solid #00ffff;
      border-radius: 3px;
    }

    .pick-status {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 3px;
    }

    .pick-status.pending {
      background: #ffff0020;
      border: 1px solid #ffff00;
      color: #ffff00;
    }

    .pick-status.approved {
      background: #00ff0020;
      border: 1px solid #00ff00;
      color: #00ff00;
    }

    .pick-status.rejected {
      background: #ff000020;
      border: 1px solid #ff0000;
      color: #ff0000;
    }

    .pick-question {
      font-size: 14px;
      line-height: 1.4;
      margin-bottom: 15px;
    }

    .pick-position {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 10px;
      background: #000;
      border-radius: 3px;
    }

    .position-side {
      font-weight: bold;
      font-size: 16px;
    }

    .position-side.yes { color: #00ff00; }
    .position-side.no { color: #ff0000; }

    .confidence-badge {
      color: #00ffff;
    }

    .pick-thesis {
      font-size: 12px;
      line-height: 1.4;
      color: #ccc;
      font-style: italic;
      margin-bottom: 15px;
      padding: 10px;
      background: #050505;
      border-left: 2px solid #ff00ff;
    }

    .pick-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      flex: 1;
      padding: 8px;
      border: 1px solid;
      background: transparent;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
    }

    .action-btn.approve {
      border-color: #00ff00;
    }

    .action-btn.approve:hover {
      background: #00ff0020;
    }

    .action-btn.reject {
      border-color: #ff0000;
    }

    .action-btn.reject:hover {
      background: #ff000020;
    }

    .action-btn.generate {
      border-color: #ff00ff;
    }

    .action-btn.generate:hover {
      background: #ff00ff20;
    }

    .new-pick-form {
      background: #111;
      border: 2px solid #ff00ff;
      border-radius: 5px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #888;
      margin-bottom: 8px;
    }

    input, select, textarea {
      background: #000;
      border: 1px solid #666;
      color: #fff;
      padding: 10px;
      font-size: 14px;
      font-family: inherit;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .submit-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #ff00ff, #00ffff);
      color: #000;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .submit-btn:hover {
      transform: scale(1.02);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: #111;
      border: 1px solid #333;
      padding: 20px;
      text-align: center;
    }

    .stat-label {
      font-size: 10px;
      text-transform: uppercase;
      color: #888;
      margin-bottom: 10px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #00ffff;
    }

    .message {
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      text-align: center;
    }

    .message.success {
      background: #00ff0020;
      border: 1px solid #00ff00;
      color: #00ff00;
    }

    .message.error {
      background: #ff000020;
      border: 1px solid #ff0000;
      color: #ff0000;
    }
  </style>
</head>
<body>
  <!-- Authentication Gate -->
  <div class="auth-gate" id="authGate">
    <h2>MIYOMI TRAINER ACCESS</h2>
    <input
      type="password"
      class="auth-input"
      placeholder="Enter trainer password"
      id="passwordInput"
      onkeypress="if(event.key==='Enter') authenticate()"
    />
    <button class="auth-btn" onclick="authenticate()">ACCESS DASHBOARD</button>
    <div id="authError" style="color: #ff0000; margin-top: 10px; display: none;">
      Invalid password
    </div>
  </div>

  <!-- Main Dashboard -->
  <div class="dashboard" id="dashboard">
    <div class="header">
      <h1>MIYOMI TRAINER DASHBOARD</h1>
      <div class="trainer-info" id="trainerInfo">Trainer: Active</div>
      <button class="logout-btn" onclick="logout()">LOGOUT</button>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('pending')">PENDING PICKS</button>
      <button class="tab" onclick="switchTab('approved')">APPROVED</button>
      <button class="tab" onclick="switchTab('create')">CREATE NEW</button>
      <button class="tab" onclick="switchTab('analytics')">ANALYTICS</button>
    </div>

    <!-- Pending Picks Tab -->
    <div class="tab-content active" id="pending-tab">
      <div class="picks-grid" id="pendingPicks">
        <!-- Pending picks will be loaded here -->
      </div>
    </div>

    <!-- Approved Picks Tab -->
    <div class="tab-content" id="approved-tab">
      <div class="picks-grid" id="approvedPicks">
        <!-- Approved picks will be loaded here -->
      </div>
    </div>

    <!-- Create New Pick Tab -->
    <div class="tab-content" id="create-tab">
      <div class="new-pick-form">
        <h3 style="color: #ff00ff; margin-bottom: 20px;">CREATE NEW CONTRARIAN PICK</h3>
        <form id="newPickForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Platform</label>
              <select id="platform" required>
                <option value="POLYMARKET">Polymarket</option>
                <option value="KALSHI">Kalshi</option>
              </select>
            </div>

            <div class="form-group">
              <label>Category</label>
              <select id="category" required>
                <option value="economy">Economy/Crypto</option>
                <option value="politics">Politics/World</option>
                <option value="culture">Culture/Society</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label>Market Question</label>
              <input type="text" id="marketQuestion" required placeholder="Will Bitcoin reach $100k by end of 2025?" />
            </div>

            <div class="form-group">
              <label>Position</label>
              <select id="position" required>
                <option value="YES">YES (Contrarian Bull)</option>
                <option value="NO">NO (Contrarian Bear)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Confidence %</label>
              <input type="number" id="confidence" min="50" max="99" required placeholder="75" />
            </div>

            <div class="form-group full-width">
              <label>Contrarian Thesis</label>
              <textarea id="thesis" required placeholder="The market is wrong because..."></textarea>
            </div>

            <div class="form-group full-width">
              <label>Video Script (30 seconds)</label>
              <textarea id="script" required placeholder="Hook: [attention grabber]\nBody: [key points]\nCTA: [call to action]"></textarea>
            </div>
          </div>

          <button type="submit" class="submit-btn">CREATE PICK & GENERATE VIDEO</button>
        </form>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" id="analytics-tab">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Picks</div>
          <div class="stat-value" id="totalPicks">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Win Rate</div>
          <div class="stat-value" id="winRate">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Edge</div>
          <div class="stat-value" id="avgEdge">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Videos Created</div>
          <div class="stat-value" id="videosCreated">0</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Simple authentication (in production, use proper auth)
    const TRAINER_PASSWORD = 'miyomi2025'; // In production, use secure authentication

    let currentPicks = {
      pending: [],
      approved: []
    };

    function authenticate() {
      const password = document.getElementById('passwordInput').value;

      if (password === TRAINER_PASSWORD) {
        document.getElementById('authGate').style.display = 'none';
        document.getElementById('dashboard').classList.add('authenticated');
        loadPicks();
        loadAnalytics();
      } else {
        document.getElementById('authError').style.display = 'block';
      }
    }

    function logout() {
      document.getElementById('dashboard').classList.remove('authenticated');
      document.getElementById('authGate').style.display = 'block';
      document.getElementById('passwordInput').value = '';
      document.getElementById('authError').style.display = 'none';
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    async function loadPicks() {
      try {
        // Load from live APIs
        const [polymarketRes, kalshiRes] = await Promise.all([
          fetch('/api/polymarket-live'),
          fetch('/api/kalshi-live')
        ]);

        const polymarketData = await polymarketRes.json();
        const kalshiData = await kalshiRes.json();

        // Combine and categorize picks
        const allMarkets = [
          ...(polymarketData.markets || []),
          ...(kalshiData.markets || [])
        ];

        // Filter markets with Miyomi analysis
        const picksWithAnalysis = allMarkets.filter(m => m.miyomiAnalysis);

        // Simulate some as pending for demo
        currentPicks.pending = picksWithAnalysis.slice(0, 3).map(m => ({
          ...m,
          status: 'pending',
          id: Math.random().toString(36).substr(2, 9)
        }));

        currentPicks.approved = picksWithAnalysis.slice(3, 6).map(m => ({
          ...m,
          status: 'approved',
          id: Math.random().toString(36).substr(2, 9)
        }));

        displayPicks();
      } catch (error) {
        console.error('Error loading picks:', error);
      }
    }

    function displayPicks() {
      // Display pending picks
      const pendingContainer = document.getElementById('pendingPicks');
      pendingContainer.innerHTML = currentPicks.pending.length > 0
        ? currentPicks.pending.map(pick => createPickCard(pick, 'pending')).join('')
        : '<div style="text-align: center; color: #888;">No pending picks</div>';

      // Display approved picks
      const approvedContainer = document.getElementById('approvedPicks');
      approvedContainer.innerHTML = currentPicks.approved.length > 0
        ? currentPicks.approved.map(pick => createPickCard(pick, 'approved')).join('')
        : '<div style="text-align: center; color: #888;">No approved picks</div>';
    }

    function createPickCard(pick, status) {
      const question = pick.question || pick.title || pick.market;
      const platform = pick.platform || pick.source || 'UNKNOWN';
      const analysis = pick.miyomiAnalysis || {};

      return `
        <div class="pick-card">
          <div class="pick-header">
            <span class="pick-platform">${platform}</span>
            <span class="pick-status ${status}">${status.toUpperCase()}</span>
          </div>
          <div class="pick-question">${question}</div>
          <div class="pick-position">
            <span class="position-side ${analysis.position?.toLowerCase()}">${analysis.position || 'N/A'}</span>
            <span class="confidence-badge">${analysis.confidence || 0}% confidence</span>
          </div>
          <div class="pick-thesis">"${analysis.thesis || 'No thesis provided'}"</div>
          <div class="pick-actions">
            ${status === 'pending' ? `
              <button class="action-btn approve" onclick="approvePick('${pick.id}')">APPROVE</button>
              <button class="action-btn reject" onclick="rejectPick('${pick.id}')">REJECT</button>
            ` : `
              <button class="action-btn generate" onclick="generateVideo('${pick.id}')">GENERATE VIDEO</button>
            `}
          </div>
        </div>
      `;
    }

    async function approvePick(pickId) {
      const pick = currentPicks.pending.find(p => p.id === pickId);
      if (pick) {
        currentPicks.pending = currentPicks.pending.filter(p => p.id !== pickId);
        currentPicks.approved.push({ ...pick, status: 'approved' });
        displayPicks();
        showMessage('Pick approved successfully', 'success');
      }
    }

    function rejectPick(pickId) {
      currentPicks.pending = currentPicks.pending.filter(p => p.id !== pickId);
      displayPicks();
      showMessage('Pick rejected', 'error');
    }

    async function generateVideo(pickId) {
      const pick = currentPicks.approved.find(p => p.id === pickId);
      if (!pick) return;

      try {
        const response = await fetch('/api/generate-video-v2', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            category: 'economy',
            position: pick.miyomiAnalysis?.position,
            thesis: pick.miyomiAnalysis?.thesis,
            script: `Contrarian take on: ${pick.question}`,
            style: 'contrarian_oracle'
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`Video generation started! Task ID: ${result.taskId}`, 'success');
        } else {
          showMessage('Video generation failed', 'error');
        }
      } catch (error) {
        console.error('Error generating video:', error);
        showMessage('Video generation failed', 'error');
      }
    }

    function loadAnalytics() {
      // Simulate analytics data
      document.getElementById('totalPicks').textContent =
        currentPicks.pending.length + currentPicks.approved.length;
      document.getElementById('winRate').textContent = '73%';
      document.getElementById('avgEdge').textContent = '28%';
      document.getElementById('videosCreated').textContent = '42';
    }

    function showMessage(text, type) {
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.textContent = text;
      document.body.appendChild(message);

      setTimeout(() => {
        message.remove();
      }, 3000);
    }

    // Handle new pick form submission
    document.getElementById('newPickForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        platform: document.getElementById('platform').value,
        category: document.getElementById('category').value,
        question: document.getElementById('marketQuestion').value,
        position: document.getElementById('position').value,
        confidence: document.getElementById('confidence').value,
        thesis: document.getElementById('thesis').value,
        script: document.getElementById('script').value
      };

      try {
        // Generate video with the new pick
        const response = await fetch('/api/generate-video-v2', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            category: formData.category,
            position: `${formData.position} on ${formData.question}`,
            thesis: formData.thesis,
            script: formData.script,
            style: 'contrarian_oracle'
          })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('Pick created and video generation started!', 'success');
          e.target.reset();
          loadPicks();
        } else {
          showMessage('Failed to create pick', 'error');
        }
      } catch (error) {
        console.error('Error creating pick:', error);
        showMessage('Failed to create pick', 'error');
      }
    });
  </script>
</body>
</html>