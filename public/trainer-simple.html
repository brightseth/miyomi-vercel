<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIYOMI - Trainer Interface</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000;
      color: #fff;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      padding: 20px;
    }

    .header {
      border-bottom: 2px solid #ff0;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }

    h1 {
      color: #ff0;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #888;
      font-size: 0.9rem;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #ff0;
      font-size: 1.2rem;
    }

    .error {
      background: #300;
      border: 2px solid #f00;
      padding: 20px;
      margin: 20px 0;
      color: #f00;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat {
      background: #111;
      border: 1px solid #ff0;
      padding: 15px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.8rem;
      color: #ff0;
      display: block;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.7rem;
      color: #888;
      text-transform: uppercase;
    }

    .market {
      background: #111;
      border: 2px solid #333;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.2s;
    }

    .market:hover {
      border-color: #ff0;
    }

    .market-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }

    .market-question {
      font-size: 1.1rem;
      max-width: 70%;
      line-height: 1.3;
    }

    .market-edge {
      background: #0f0;
      color: #000;
      padding: 5px 12px;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .market-details {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px;
      margin: 15px 0;
      padding: 15px 0;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
    }

    .detail {
      text-align: center;
    }

    .detail-label {
      font-size: 0.65rem;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .detail-value {
      font-size: 1rem;
      color: #fff;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .btn-approve {
      background: #0f0;
      color: #000;
    }

    .btn-approve:hover {
      background: #0c0;
    }

    .btn-video {
      background: #f0f;
      color: #fff;
    }

    .btn-video:hover {
      background: #c0c;
    }

    .btn-reject {
      background: #f00;
      color: #fff;
    }

    .btn-reject:hover {
      background: #c00;
    }

    .btn-view {
      background: #333;
      color: #fff;
    }

    .btn-view:hover {
      background: #555;
    }

    .filters {
      background: #111;
      border: 1px solid #333;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-label {
      color: #888;
      font-size: 0.8rem;
      margin-right: 10px;
    }

    select {
      background: #000;
      color: #fff;
      border: 1px solid #ff0;
      padding: 8px 12px;
      font-family: inherit;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üéØ MIYOMI MARKET SCANNER</h1>
    <p class="subtitle">Contrarian Opportunity Finder ‚Ä¢ Live Polymarket Data</p>
  </div>

  <div class="stats">
    <div class="stat">
      <span class="stat-value" id="total-markets">-</span>
      <span class="stat-label">Total Opportunities</span>
    </div>
    <div class="stat">
      <span class="stat-value" id="avg-edge">-</span>
      <span class="stat-label">Avg Edge</span>
    </div>
    <div class="stat">
      <span class="stat-value" id="high-edge">-</span>
      <span class="stat-label">Highest Edge</span>
    </div>
    <div class="stat">
      <span class="stat-value" id="last-update">-</span>
      <span class="stat-label">Last Update</span>
    </div>
  </div>

  <div class="filters">
    <span class="filter-label">FILTER:</span>
    <select id="position-filter">
      <option value="all">All Positions</option>
      <option value="YES">YES Positions Only</option>
      <option value="NO">NO Positions Only</option>
    </select>
    <select id="edge-filter">
      <option value="0">All Edges</option>
      <option value="50">Edge > 50%</option>
      <option value="100">Edge > 100%</option>
      <option value="200">Edge > 200%</option>
    </select>
    <button onclick="loadMarkets()" style="padding: 8px 20px; background: #ff0; color: #000; border: none; font-weight: bold; cursor: pointer;">
      üîÑ REFRESH
    </button>
  </div>

  <div id="loading" class="loading">Loading markets...</div>
  <div id="error" class="error" style="display: none;"></div>
  <div id="markets-container"></div>

  <script>
    let allMarkets = [];

    async function loadMarkets() {
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const container = document.getElementById('markets-container');

      loading.style.display = 'block';
      error.style.display = 'none';
      container.innerHTML = '';

      try {
        const response = await fetch('/api/markets/scan');
        const data = await response.json();

        if (!data.success) {
          throw new Error(data.error || 'Failed to load markets');
        }

        allMarkets = data.markets;
        console.log(`‚úÖ Loaded ${allMarkets.length} markets`);

        // Update stats
        document.getElementById('total-markets').textContent = allMarkets.length;

        if (allMarkets.length > 0) {
          const avgEdge = (allMarkets.reduce((sum, m) => sum + m.edge, 0) / allMarkets.length).toFixed(0);
          const highEdge = Math.max(...allMarkets.map(m => m.edge));

          document.getElementById('avg-edge').textContent = `+${avgEdge}%`;
          document.getElementById('high-edge').textContent = `+${highEdge}%`;
        }

        const updateTime = new Date(data.lastUpdate);
        document.getElementById('last-update').textContent = updateTime.toLocaleTimeString();

        // Render markets
        renderMarkets();

        loading.style.display = 'none';

      } catch (err) {
        console.error('Error loading markets:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
        error.textContent = `Error: ${err.message}`;
      }
    }

    function renderMarkets() {
      const container = document.getElementById('markets-container');
      const positionFilter = document.getElementById('position-filter').value;
      const edgeFilter = parseInt(document.getElementById('edge-filter').value);

      // Apply filters
      const filtered = allMarkets.filter(m => {
        if (positionFilter !== 'all' && m.position !== positionFilter) return false;
        if (m.edge < edgeFilter) return false;
        return true;
      });

      container.innerHTML = filtered.map(market => `
        <div class="market">
          <div class="market-header">
            <div class="market-question">${market.question}</div>
            <div class="market-edge">EDGE: +${market.edge}%</div>
          </div>

          <div class="market-details">
            <div class="detail">
              <div class="detail-label">Position</div>
              <div class="detail-value">${market.position}</div>
            </div>
            <div class="detail">
              <div class="detail-label">Consensus</div>
              <div class="detail-value">${market.consensus}%</div>
            </div>
            <div class="detail">
              <div class="detail-label">YES Price</div>
              <div class="detail-value">$${market.yesPrice}</div>
            </div>
            <div class="detail">
              <div class="detail-label">NO Price</div>
              <div class="detail-value">$${market.noPrice}</div>
            </div>
            <div class="detail">
              <div class="detail-label">Volume</div>
              <div class="detail-value">$${(market.volume / 1000).toFixed(0)}K</div>
            </div>
          </div>

          <div class="actions">
            <button class="btn btn-approve" onclick="approveMarket('${market.id}')">
              ‚úÖ APPROVE
            </button>
            <button class="btn btn-video" onclick="scheduleVideo('${market.id}')">
              üé• VIDEO
            </button>
            <button class="btn btn-view" onclick="window.open('${market.url}', '_blank')">
              üëÅÔ∏è VIEW
            </button>
            <button class="btn btn-reject" onclick="rejectMarket('${market.id}')">
              ‚ùå REJECT
            </button>
          </div>
        </div>
      `).join('');

      if (filtered.length === 0) {
        container.innerHTML = '<div class="loading">No markets match your filters</div>';
      }
    }

    function approveMarket(id) {
      console.log('‚úÖ Approved market:', id);
      alert('Market approved! (Would save to database in production)');
    }

    function scheduleVideo(id) {
      console.log('üé• Scheduling video for:', id);
      alert('Video scheduled! (Would call Eden API in production)');
    }

    function rejectMarket(id) {
      console.log('‚ùå Rejected market:', id);
      const market = allMarkets.find(m => m.id === id);
      if (market && confirm(`Reject: "${market.question}"?`)) {
        // Remove from display
        allMarkets = allMarkets.filter(m => m.id !== id);
        renderMarkets();
      }
    }

    // Add event listeners for filters
    document.getElementById('position-filter').addEventListener('change', renderMarkets);
    document.getElementById('edge-filter').addEventListener('change', renderMarkets);

    // Load markets on page load
    loadMarkets();

    // Auto-refresh every 5 minutes
    setInterval(loadMarkets, 5 * 60 * 1000);
  </script>
</body>
</html>
